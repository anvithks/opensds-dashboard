<p-growl [value]="msgs" [sticky]="false" [life]="6000"></p-growl>
<div id="register-storage-page">
    <div class="page-header">
        <div class="custom-breadcrumb">
            <span *ngFor="let item of items; index as i">
                <a [ngClass]="{'font-color-class': i===0}" [routerLink]="[item.url]">{{item.label}}</a>
                <span *ngIf="(i+1) !== items.length">></span>
            </span>
        </div>
        <div class="content-header">
            <h1>Register Storage</h1>
            <p>Fill the form and register the storage</p>
        </div>
        <hr />
    </div>
    <form [formGroup]="registerStorageForm" [grid]="{label: 'ui-g-3', content:'ui-g-20'}" (ngSubmit)="onSubmit(registerStorageForm.value)" [errorMessage]="errorMessage">
        
        <form-item label="{{label.name}}">
            <input formControlName="name" type="text" size="30" pInputText [maxlength]="128" [minlength]="2"> 
        </form-item>
        <form-item label="{{label.description}}">
            <textarea [rows]="5" [cols]="30" pInputTextarea formControlName="description" [maxlength]="250" [minlength]="2"></textarea>
        </form-item>
        <form-item label="{{label.vendor}}" [required]="true">
            <p-dropdown [style]="{'min-width':'150px','width':'220px'}" placeholder="Please select" [options]="vendorOptions" (onChange)="getModelsByVendor(selectedVendor)" name='selectedVendor' [(ngModel)]='selectedVendor' formControlName="vendor"></p-dropdown>
        </form-item>
        <form-item label="{{label.model}}" [required]="true">
            <p-dropdown [style]="{'min-width':'150px','width':'220px'}" placeholder="Please select" [options]="modelOptions" formControlName="model"></p-dropdown>
        </form-item>
        <form-item [required]="true" label="{{label.host}}">
            <input formControlName="host" type="text" size="30" pInputText> 
        </form-item>
        <form-item [required]="true" label="{{label.port}}">
            <input formControlName="port" type="text" size="30" pInputText> 
        </form-item>
        <form-item [required]="true" label="{{label.username}}">
            <input formControlName="username" type="text" size="30" pInputText> 
        </form-item>
        <form-item [required]="true" label="{{label.password}}">
            <input formControlName="password" type="password" size="30" pInputText> 
        </form-item>

        <form-item *ngIf="registerStorageForm.controls['extra_attributes']" [required]="true" label="{{label.extra_attributes}}">
            <a class="add-extra-attribute" (click)="addNextAttribute()"><i class="fa fa-plus-circle" ></i></a>
            <div class="extra-attribute-array" formArrayName="extra_attributes"
                *ngFor="let item of registerStorageForm.get('extra_attributes')['controls']; let i = index">
                <div class="ui-g ui-fluid" [formGroupName]="i">
                    <div class="ui-g-12 ui-md-4">
                        <div class="ui-inputgroup">
                            <input type="text" pInputText formControlName='key' placeholder="Key">
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-4 ui-md-offset-1">
                        <div class="ui-inputgroup">
                            <input type="text" pInputText formControlName='value' placeholder="Value">
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-2 ui-md-offset-1">
                        <div class="ui-inputgroup">
                            <a  disabled="registerStorageForm.get('extra_attributes')['length'] > 1" 
                                class="remove-extra-attribute" 
                                (click)="removeAttributeLink(i)">
                                <i class="fa fa-minus-circle"></i>
                            </a>     
                        </div>
                    </div>
                </div>
            </div>
            
        </form-item>
            
    
        <div class="bottom-button-margin">
            <button pButton type="submit" class="ui-button-secondary" label="{{i18n.keyID['ok']}}" [disabled]="registerStorageForm.invalid" ></button>
            <button pButton type="button" label="{{i18n.keyID['cancel']}}" [routerLink]="['/delfin']"></button>
        </div>
    </form>
</div>